
in preprocessing:
  1. mvn clean package assembly:single

in newsleak-frontend
  2. docker build -t uhhlt/newsleak:v1.0 .
  3. docker push uhhlt/newsleak:v1.0


update Docker/newsleak-docker
  set to new version v0.5!


--
performance

100.000 docs in 8 hours on ltmac6

-- 
on remote server

in newsleak-docker:

  1. docker-compose down -v
  2. checkout newsleak-docker (oder: docker rmi uhhlt/newsleak-frontend:v0.5, docker pull uhhlt/newsleak-frontend:v0.5)
  3. follow README instructions

docker exec -it newsleakdocker_newsleak-ner_1 bash
polyglot download embeddings2.es embeddings2.hu ner2.es ner2.hu

docker exec -it newsleakdocker_newsleak-ui_1 sh -c "cd /opt/newsleak/preprocessing && java -Xmx10g -jar target/preprocessing-0.5-jar-with-dependencies.jar -c /etc/settings/conf/newsleak_wwii.properties"



################################
##     NEWSLEAK CONFIG          ##
################################

indexname = wwiinewsleak

dbname = wwiinewsleak
dbuser = newsreader
dbpass = newsreader
dburl = newsleak-postgres:5432
dbschema = desc/postgresSchema.sql
dbindices = desc/postgresIndices.sql

processlanguages = deu, eng, spa, hun
defaultlanguage = eng
datareader = hoover

datadirectory = ./data
documentfile = document.csv
metadatafile = metadata.csv

esurl = newsleak-elasticsearch
esclustername = elasticsearch
esindex = wwiinewsleak
esport = 9300

hooverclustername = elasticsearch
hooverurl = search-es
hooverindex = ww2
hooverport = 9300
hoovertmpmetadata = hoover_metadata.csv

dictionaryfiles = nsdap.all
nerserviceurl = newsleak-ner:5001

threads = 40
debugMaxDocuments = 0



------------------
1. WW2
2. Emails
3. NSU
4. htsmall
5. htmidi


------------------
DEBUG setup


remote:

on ltdocker: run gw-newsleak-spiegel with opened ports 39300 and 35432
on ltmac6: 
  open two tunnels
    ssh -L 39300:localhost:39300 -L 35432:localhost:35432 ltdocker
  in Projects/newsleak-frontend run newsleak application
    sbt -jvm-debug 9999 run

local:
  in hoover2 run
    docker-compose up -d

in Projects/newsleak-frontend run newsleak application (set correct application.conf parameters!)
    sbt run

  in newsleak-docker run
    docker-compose up -d


-------------------

snoop2 API

curl localhost:45025/collections/htsmall/feed?lt=2018-11-27T20:22:19.324083Z | python -m json.tool




-------------------



USER in dockerfile

sbt dist (nur das nÃ¶tigste -> braucht kein sbt!)

app secret (https://www.playframework.com/documentation/2.7.x/Deploying)

application.conf -> production mode



===================

Create Docker image
-------------------

in preprocessing:
  mvn clean package assembly:single
  mv target/preprocessing-0.9-jar-with-dependencies.jar target/preprocessing-jar-with-dependencies.jar

in newsleak-frontend:
  sbt dist
  unzip target/universal/newsleak-ui.zip -d target/universal/
  docker build -t uhhlt/newsleak:v1.0 .

in hoover2
  docker-compose up -d

in newsleak-docker
  docker-compose up -d


docker exec -it newsleak-docker_newsleak-ui_1 sh -c "cd /opt/newsleak && java -Xmx10g -jar preprocessing.jar -c /etc/settings/conf/newsleak.properties"
